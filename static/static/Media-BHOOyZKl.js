import{V as l,m as o,n as r}from"./index-BM-DvTdL.js";import{E as n}from"./EmptyPlaceholder-gXY-9UQQ.js";const d=l.extend({components:{EmptyPlaceholder:n},name:"Media",props:{isModal:Boolean,type:{type:String,default:""}},data(){return{form:{files:[]},toUpload:0,uploaded:0,showUploadForm:!1,queryParams:{page:1,query:""}}},methods:{removeUploadFile(s){this.form.files.splice(s,1)},getMedia(){this.$api.getMedia({page:this.queryParams.page,query:this.queryParams.query})},onToggleForm(){this.showUploadForm=!this.showUploadForm,this.$utils.setPref("media.upload",this.showUploadForm)},onQueryMedia(){this.queryParams.page=1,this.getMedia()},onMediaSelect(s,e){this.isModal&&(e.preventDefault(),this.$emit("selected",s),this.$parent.close())},onSubmit(){this.toUpload=this.form.files.length;for(let s=0;s<this.toUpload;s+=1){const e=new FormData;e.set("file",this.form.files[s]),this.$api.uploadMedia(e).then(()=>{this.onUploaded()},()=>{this.onUploaded()})}},onDeleteMedia(s){this.$api.deleteMedia(s).then(()=>{this.getMedia()})},onUploaded(){this.uploaded+=1,this.uploaded>=this.toUpload&&(this.toUpload=0,this.uploaded=0,this.form.files=[],this.getMedia())},onPageChange(s){this.queryParams.page=s,this.getMedia()}},computed:{...o(["loading","media","serverConfig"]),isProcessing(){return this.toUpload>0&&this.uploaded<this.toUpload}},mounted(){this.$api.getMedia(),this.$utils.getPref("media.upload")&&(this.showUploadForm=!0)}});var p=function(){var e=this,a=e._self._c;return e._self._setupProxy,a("section",{staticClass:"media-files"},[a("h1",{staticClass:"title is-4"},[e._v(" "+e._s(e.$t("media.title"))+" "),e.media.results&&e.media.results.length>0?a("span",[e._v("("+e._s(e.media.results.length)+")")]):e._e(),a("span",{staticClass:"has-text-grey-light"},[e._v(" / "+e._s(e.serverConfig.media_provider))])]),a("b-loading",{attrs:{active:e.isProcessing||e.loading.media}}),a("section",{staticClass:"wrap gallery mt-6"},[a("div",{staticClass:"columns mb-4"},[a("div",{staticClass:"column"},[a("form",{staticClass:"search",on:{submit:function(t){return t.preventDefault(),e.onQueryMedia.apply(null,arguments)}}},[a("div",[a("b-field",[a("b-input",{ref:"query",attrs:{name:"query",expanded:"",icon:"magnify","data-cy":"query"},model:{value:e.queryParams.query,callback:function(t){e.$set(e.queryParams,"query",t)},expression:"queryParams.query"}}),a("p",{staticClass:"controls"},[a("b-button",{attrs:{"native-type":"submit",type:"is-primary","icon-left":"magnify","data-cy":"btn-query"}})],1)],1)],1)])]),e.$can("media:manage")?a("div",{staticClass:"column is-narrow"},[a("b-button",{attrs:{"icon-left":"file-upload-outline","data-cy":"btn-toggle-upload"},on:{click:e.onToggleForm}},[e._v(" "+e._s(e.$t("media.upload"))+" ")])],1):e._e()]),e.$can("media:manage")?a("b-collapse",{attrs:{animation:""},model:{value:e.showUploadForm,callback:function(t){e.showUploadForm=t},expression:"showUploadForm"}},[a("form",{staticClass:"mb-6",attrs:{"data-cy":"upload"},on:{submit:function(t){return t.preventDefault(),e.onSubmit.apply(null,arguments)}}},[a("div",[a("b-field",{attrs:{label:e.$t("media.upload")}},[a("b-upload",{attrs:{"drag-drop":"",multiple:"",xaccept:".png,.jpg,.jpeg,.gif,.svg",expanded:""},model:{value:e.form.files,callback:function(t){e.$set(e.form,"files",t)},expression:"form.files"}},[a("div",{staticClass:"has-text-centered section"},[a("p",[a("b-icon",{attrs:{icon:"file-upload-outline",size:"is-large"}})],1),a("p",[e._v(e._s(e.$t("media.uploadHelp")))])])])],1),e.form.files.length>0?a("div",{staticClass:"tags"},e._l(e.form.files,function(t,i){return a("b-tag",{key:i,attrs:{size:"is-medium",closable:""},on:{close:function(c){return e.removeUploadFile(i)}}},[e._v(" "+e._s(t.name)+" ")])}),1):e._e(),a("div",{staticClass:"buttons"},[a("b-button",{attrs:{"native-type":"submit",type:"is-primary","icon-left":"file-upload-outline",disabled:e.form.files.length===0,loading:e.isProcessing}},[e._v(" "+e._s(e.$tc("media.upload"))+" ")])],1)],1)])]):e._e(),e.media.total>e.media.perPage?a("div",{staticClass:"pagination-wrapper mt-5"},[a("b-pagination",{attrs:{total:e.media.total,current:e.media.page,"per-page":e.media.perPage},on:{"update:current":function(t){return e.$set(e.media,"page",t)},change:e.onPageChange}})],1):e._e(),e.loading.media?a("div",{staticClass:"has-text-centered py-6"},[a("b-loading",{attrs:{active:e.loading.media}})],1):e.media.results&&e.media.results.length>0?a("div",{staticClass:"grid"},e._l(e.media.results,function(t){return a("div",{key:t.id,staticClass:"item"},[a("div",{staticClass:"thumb"},[a("a",{staticClass:"thumb-link",attrs:{href:t.url,target:"_blank",rel:"noopener noreferer"},on:{click:i=>e.onMediaSelect(t,i)}},[a("div",{staticClass:"thumb-container"},[t.thumbUrl?a("img",{attrs:{src:t.thumbUrl,title:t.filename,alt:t.filename}}):a("div",{staticClass:"thumb-placeholder"},[a("span",{staticClass:"file-ext"},[e._v(" "+e._s(t.filename.split(".").pop().toUpperCase())+" ")])])])]),a("div",{staticClass:"actions"},[a("a",{staticClass:"delete-btn",attrs:{href:"#","data-cy":"btn-delete","aria-label":e.$t("globals.buttons.delete")},on:{click:function(i){i.preventDefault(),e.$utils.confirm(null,()=>e.onDeleteMedia(t.id))}}},[a("b-icon",{attrs:{icon:"trash-can-outline",size:"is-small"}})],1)])]),a("div",{staticClass:"info"},[a("p",{staticClass:"filename",attrs:{title:t.filename}},[e._v(e._s(t.filename))]),a("p",{staticClass:"date"},[e._v(e._s(e.$utils.niceDate(t.createdAt,!1)))])])])}),0):e.loading.media?e._e():a("div",[a("empty-placeholder")],1),e.media.total>e.media.perPage?a("div",{staticClass:"pagination-wrapper mt-5"},[a("b-pagination",{attrs:{total:e.media.total,current:e.media.page,"per-page":e.media.perPage},on:{"update:current":function(t){return e.$set(e.media,"page",t)},change:e.onPageChange}})],1):e._e()],1)],1)},u=[],m=r(d,p,u);const h=m.exports;export{h as default};
