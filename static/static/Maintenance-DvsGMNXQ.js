import{V as n,d as i,m as l,n as c}from"./index-BM-DvTdL.js";const o=n.extend({components:{},data(){return{isLoading:!1,subscriberType:"orphan",analyticsType:"all",subscriptionType:"optin",analyticsDate:i().subtract(7,"day").toDate(),subscriptionDate:i().subtract(7,"day").toDate(),dbSettings:{vacuum:!1,vacuum_cron_interval:"0 2 * * *"}}},mounted(){this.loadDBSettings()},methods:{formatDateTime(e){return i(e).format("YYYY-MM-DD")},deleteSubscribers(){this.$utils.confirm(null,()=>{this.$api.deleteGCSubscribers(this.subscriberType).then(e=>{this.$utils.toast(this.$t("globals.messages.deletedCount",{name:this.$tc("globals.terms.subscribers",2),num:e.count}))})})},deleteSubscriptions(){this.$utils.confirm(null,()=>{this.$api.deleteGCSubscriptions(this.subscriptionDate).then(e=>{this.$utils.toast(this.$t("globals.messages.deletedCount",{name:this.$tc("globals.terms.subscriptions",2),num:e.count}))})})},deleteAnalytics(){this.$utils.confirm(null,()=>{this.$api.deleteGCCampaignAnalytics(this.analyticsType,this.analyticsDate).then(()=>{this.$utils.toast(this.$t("globals.messages.done"))})})},loadDBSettings(){this.$api.getSettings().then(e=>{e["maintenance.db"]!==void 0&&(this.dbSettings={...e["maintenance.db"]})})},async onUpdateDBSettings(){this.isLoading=!0;const e=await this.$api.updateSettingsByKey("maintenance.db",this.dbSettings);await this.$root.awaitRestart(e),this.isLoading=!1}},computed:{...l(["loading"])}});var r=function(){var t=this,s=t._self._c;return t._self._setupProxy,s("section",{staticClass:"maintenance wrap"},[s("h1",{staticClass:"title is-4"},[t._v(" "+t._s(t.$t("maintenance.title"))+" ")]),s("hr"),s("p",{staticClass:"has-text-grey"},[t._v(" "+t._s(t.$t("maintenance.help"))+" ")]),s("br"),s("div",{staticClass:"box"},[s("h4",{staticClass:"is-size-4"},[t._v(" "+t._s(t.$t("globals.terms.subscribers"))+" ")]),s("br"),s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-4"},[s("b-field",{attrs:{label:"Data",message:t.$t("maintenance.orphanHelp")}},[s("b-select",{attrs:{expanded:""},model:{value:t.subscriberType,callback:function(a){t.subscriberType=a},expression:"subscriberType"}},[s("option",{attrs:{value:"orphan"}},[t._v(" "+t._s(t.$t("dashboard.orphanSubs"))+" ")]),s("option",{attrs:{value:"blocklisted"}},[t._v(" "+t._s(t.$t("subscribers.status.blocklisted"))+" ")])])],1)],1),s("div",{staticClass:"column is-5"}),s("div",{staticClass:"column"},[s("br"),s("b-field",[s("b-button",{staticClass:"is-primary",attrs:{loading:t.loading.maintenance,expanded:""},on:{click:t.deleteSubscribers}},[t._v(" "+t._s(t.$t("globals.buttons.delete"))+" ")])],1)],1)])]),s("div",{staticClass:"box mt-6"},[s("h4",{staticClass:"is-size-4"},[t._v(" "+t._s(t.$tc("globals.terms.subscriptions",2))+" ")]),s("br"),s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-4"},[s("b-field",{attrs:{label:"Data"}},[s("b-select",{attrs:{expanded:""},model:{value:t.subscriptionType,callback:function(a){t.subscriptionType=a},expression:"subscriptionType"}},[s("option",{attrs:{value:"optin"}},[t._v(" "+t._s(t.$t("maintenance.maintenance.unconfirmedOptins"))+" ")])])],1)],1),s("div",{staticClass:"column is-4"},[s("b-field",{attrs:{label:t.$t("maintenance.olderThan")}},[s("b-datepicker",{attrs:{required:"",expanded:"",icon:"calendar-clock","date-formatter":t.formatDateTime},model:{value:t.subscriptionDate,callback:function(a){t.subscriptionDate=a},expression:"subscriptionDate"}})],1)],1),s("div",{staticClass:"column is-1"}),s("div",{staticClass:"column"},[s("br"),s("b-field",[s("b-button",{staticClass:"is-primary",attrs:{loading:t.loading.maintenance,expanded:""},on:{click:t.deleteSubscriptions}},[t._v(" "+t._s(t.$t("globals.buttons.delete"))+" ")])],1)],1)])]),s("div",{staticClass:"box mt-6"},[s("h4",{staticClass:"is-size-4"},[t._v(" "+t._s(t.$t("globals.terms.analytics"))+" ")]),s("br"),s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-4"},[s("b-field",{attrs:{label:"Data"}},[s("b-select",{attrs:{expanded:""},model:{value:t.analyticsType,callback:function(a){t.analyticsType=a},expression:"analyticsType"}},[s("option",{attrs:{selected:"",value:"all"}},[t._v(" "+t._s(t.$t("globals.terms.all"))+" ")]),s("option",{attrs:{value:"views"}},[t._v(" "+t._s(t.$t("dashboard.campaignViews"))+" ")]),s("option",{attrs:{value:"clicks"}},[t._v(" "+t._s(t.$t("dashboard.linkClicks"))+" ")])])],1)],1),s("div",{staticClass:"column is-4"},[s("b-field",{attrs:{label:t.$t("maintenance.olderThan")}},[s("b-datepicker",{attrs:{required:"",expanded:"",icon:"calendar-clock","date-formatter":t.formatDateTime},model:{value:t.analyticsDate,callback:function(a){t.analyticsDate=a},expression:"analyticsDate"}})],1)],1),s("div",{staticClass:"column is-1"}),s("div",{staticClass:"column"},[s("br"),s("b-field",[s("b-button",{staticClass:"is-primary",attrs:{expanded:"",loading:t.loading.maintenance},on:{click:t.deleteAnalytics}},[t._v(" "+t._s(t.$t("globals.buttons.delete"))+" ")])],1)],1)])]),s("form",{staticClass:"box mt-6",on:{submit:function(a){return a.preventDefault(),t.onUpdateDBSettings.apply(null,arguments)}}},[s("h4",{staticClass:"is-size-4"},[t._v(" "+t._s(t.$t("maintenance.database.title"))+" ")]),s("br"),s("h5",{staticClass:"is-size-5"},[t._v("Vacuum")]),s("p",{staticClass:"has-text-grey is-size-7"},[t._v(" "+t._s(t.$t("maintenance.database.vacuumHelp"))+" ")]),s("br"),s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-2"},[s("b-field",{attrs:{label:t.$t("globals.buttons.enabled")}},[s("b-switch",{model:{value:t.dbSettings.vacuum,callback:function(a){t.$set(t.dbSettings,"vacuum",a)},expression:"dbSettings.vacuum"}})],1)],1),s("div",{staticClass:"column is-4",class:{disabled:!t.dbSettings.vacuum}},[s("b-field",{attrs:{label:t.$t("settings.maintenance.cron")}},[s("b-input",{attrs:{placeholder:"0 2 * * *",disabled:!t.dbSettings.vacuum,pattern:"((\\*|[0-9,\\-\\/]+)\\s+){4}(\\*|[0-9,\\-\\/]+)"},model:{value:t.dbSettings.vacuum_cron_interval,callback:function(a){t.$set(t.dbSettings,"vacuum_cron_interval",a)},expression:"dbSettings.vacuum_cron_interval"}})],1)],1),s("div",{staticClass:"column is-3"}),s("div",{staticClass:"column is-3"},[s("br"),s("b-button",{attrs:{type:"is-primary","native-type":"submit",loading:t.loading.settings,expanded:""}},[t._v(" "+t._s(t.$t("globals.buttons.save"))+" ")])],1)])]),t.isLoading?s("b-loading",{attrs:{"is-full-page":!0,active:""}}):t._e()],1)},d=[],u=c(o,r,d);const m=u.exports;export{m as default};
